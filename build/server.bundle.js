!function(e){var n={};function o(t){if(n[t])return n[t].exports;var s=n[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=e,o.c=n,o.d=function(e,n,t){o.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,n){if(1&n&&(e=o(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(o.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var s in e)o.d(t,s,function(n){return e[n]}.bind(null,s));return t},o.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(n,"a",n),n},o.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},o.p="/",o(o.s=4)}([function(e,n){e.exports=require("express")},function(e,n){e.exports=require("aws-sdk")},function(e,n){e.exports=require("mongoose")},function(e,n){e.exports=require("dotenv")},function(e,n,o){var t=o(0),s=t(),r=o(2),i=o(5),u=process.env.PORT||8080;s.use(t.static("build")),s.use(i.urlencoded({extended:!0})),s.use(i.json()),o(6)(s),r.connect(process.env.MONGODB_URI||"mongodb://localhost/api",{useNewUrlParser:!0}).then(function(){console.log("Mongo is connected")}).catch(function(e){console.log(e),console.log("[31m[1m MongoDB Not Connected")}),s.listen(u,function(){return console.log("Listening on port 8080!")})},function(e,n){e.exports=require("body-parser")},function(e,n,o){e.exports=function(e){e.use("/main",o(7))}},function(e,n,o){var t=o(0).Router();t.use("/user",o(8)),t.use("/login",o(12)),t.use("/contactowner",o(14)),e.exports=t},function(e,n,o){var t=o(0).Router();t.use("/approval",o(9)),e.exports=t},function(e,n,o){o(10);var t=o(0).Router();o(11);t.get("/test",function(e,n){return n.send("hello")}),t.post("/post",function(e,n){console.log(e.body),n.send(e.body)}),e.exports=t},function(e,n,o){var t=o(2),s=new(0,t.Schema)({name:{type:String,required:!0,max:100},price:{type:Number,required:!0}});e.exports=t.model("Product",s)},function(e,n){e.exports=require("os")},function(e,n,o){var t=o(0).Router();t.use("/auth",o(13)),e.exports=t},function(e,n,o){function t(e,n,o){return n in e?Object.defineProperty(e,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[n]=o,e}var s=o(0).Router();o(3).config();var r=o(1);r.config.update({region:"ca-central-1"});var i=new r.CognitoIdentityServiceProvider;s.post("/authenticateUser",function(e,n){var o=e.body,s={AuthFlow:"USER_PASSWORD_AUTH",ClientId:process.env.ClientId,AuthParameters:{USERNAME:o.value.user,PASSWORD:o.value.pass}};i.initiateAuth(s,function(e,s){if(e)n.json(e);else if(s.ChallengeName===process.env.Challenge_NEW_PASS)n.json({changePass:"changePass",session:s.Session});else if(s.ChallengeName===process.env.Challenge_MFA)console.log(s),n.json({MFA:"MFA",session:s.Session,user:o.value.user});else{var i=s.AuthenticationResult.AccessToken,u=s.AuthenticationResult.IdToken;r.config.credentials=new r.CognitoIdentityCredentials({IdentityPoolId:process.env.IdentityPoolId,Logins:t({},process.env.CognitoIdp,u),LoginId:o.value.user,region:process.env.Region}),n.json({accessToken:i,idToken:u,user:o.value.user})}})}),s.post("/sendNewPass",function(e,n){var o={ChallengeName:process.env.Challenge_NEW_PASS,ClientId:process.env.ClientId,ChallengeResponses:{USERNAME:"".concat(e.body.user),NEW_PASSWORD:"".concat(e.body.newPass)},Session:e.body.session};i.respondToAuthChallenge(o,function(o,t){if(o)n.json(o);else if(t.ChallengeName===process.env.Challenge_MFA)console.log(t),n.json({MFA:"MFA",session:t.Session,user:e.body.user});else{var s=t.AuthenticationResult.AccessToken,r=t.AuthenticationResult.IdToken;n.json({accessToken:s,idToken:r,user:e.body.user})}})}),s.post("/sendmfa",function(e,n){var o=e.body,s={ChallengeName:process.env.Challenge_MFA,ClientId:process.env.ClientId,ChallengeResponses:{USERNAME:"".concat(e.body.value.user),SMS_MFA_CODE:"".concat(o.value.MFA)},Session:e.body.value.session};i.respondToAuthChallenge(s,function(s,i){if(s)n.json(s);else{var u=i.AuthenticationResult.AccessToken,a=i.AuthenticationResult.IdToken;r.config.credentials=new r.CognitoIdentityCredentials({IdentityPoolId:process.env.IdentityPoolId,Logins:t({},process.env.CognitoIdp,a),LoginId:o.value.user,region:process.env.Region}),n.json({accessToken:u,idToken:a,user:e.body.value.user})}})}),s.post("/logoutuser",function(e,n){var o=JSON.parse(e.body.value.uservalTemp);console.log(o);var t={AccessToken:"".concat(o.accessToken)};i.globalSignOut(t,function(e,o){e?n.json({putData:e,signOut:!1}):n.json({putData:o,signOut:!0})})}),e.exports=s},function(e,n,o){var t=o(0).Router();t.use("/auth",o(15)),e.exports=t},function(e,n,o){var t=o(0).Router();o(3).config();var s=o(16);o(1).config.update({region:"us-east-1"}),t.post("/sendinfo",function(e,n,o){return s.sendMail("".concat(process.env.Contact_Email),["".concat(process.env.Contact_Email)],e.body).then(function(){return n.send(e.body)}).catch(o)}),e.exports=t},function(e,n,o){var t=o(1);t.config.update({region:"us-east-1"});var s=function(e){return"\n    <p><strong>Name:</strong> ".concat(e.name,'</p>\n    <p><strong>Email:</strong> <a href="mailto:').concat(e.email,'">').concat(e.email,"</a></p>\n    <p><strong>Message:</strong> ").concat(e.message,"</p>\n  ")};e.exports.sendMail=function(e,n,o){console.log(o);var r={Destination:{ToAddresses:n},Message:{Subject:{Charset:"UTF-8",Data:"Website Enquiry"},Body:{Html:{Charset:"UTF-8",Data:s(o)}}},Source:e};return(new t.SES).sendEmail(r).promise().then(function(e){return e}).catch(function(e){throw new Error(e)})}}]);