!function(e){var n={};function o(t){if(n[t])return n[t].exports;var s=n[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=e,o.c=n,o.d=function(e,n,t){o.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,n){if(1&n&&(e=o(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(o.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var s in e)o.d(t,s,function(n){return e[n]}.bind(null,s));return t},o.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(n,"a",n),n},o.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},o.p="/",o(o.s=7)}([function(e,n){e.exports=require("express")},function(e,n){e.exports=require("csv-parse")},function(e,n){e.exports=require("dotenv")},function(e,n){e.exports=require("multer")},function(e,n,o){var t=o(15),s={ACCOUNT:20,DESCRIPTION:21,AMOUNT:22,CODE:23,YEAR:24,MONTH:25,ID:26};e.exports={storeData:function(e){var n,o=[];n=e;var r=[],c=function(e){this.gridColumnEvents=e},i=0;if(Object.entries(n[0]).map(function(e){var n=t(e,2),o=n[0];return n[1],o.toUpperCase()in s}).includes(!1))return!1;for(;i<n.length;){var a=Object.entries(n[i]).map(function(e){var n=t(e,2),o=n[0];return{value:n[1],command:"SetGridCellValue",columnID:s[o.toUpperCase().trim()]}});r.push(a),i++}for(var u=0;u<r.length;){var l=new c(r[u]);o.push(l),u++}return{finalForJDE:o,originalData:n}}}},function(e,n,o){var t=o(1);o(16);e.exports={readFile:function(e,n,o,s){var r=[];t(e,{columns:!0}).on("data",function(e){Object.keys(e).map(function(n,o){r.push(e[n])})}).on("end",function(){!function(e,n,o,t){var s=o,r={val:"",status:null};if(e.includes(o.toUpperCase())){try{Object.values(n.originalData).forEach(function(e){if(e.Code.toUpperCase()!==s)throw r.val=e.Code.toUpperCase(),r.status=!1,"unauthorized";r.val=s,r.status=!0})}catch(e){if("unauthorized"===e)return t("Partner does not exist"),!1}t("Partner exists")}else t("Partner does not exist")}(r,n,o,s)})}}},function(e,n){e.exports=require("aws-sdk")},function(e,n,o){var t=o(0),s=t(),r=o(8),c=o(9),i=process.env.PORT||8080;s.use(t.static("build")),s.use(c.urlencoded({extended:!0})),s.use(c.json()),o(10)(s),r.connect(process.env.MONGODB_URI||"mongodb://localhost/api",{useNewUrlParser:!0}).then(function(){console.log("Mongo is connected")}).catch(function(e){console.log(e),console.log("[31m[1m MongoDB Not Connected")}),s.listen(i,function(){return console.log("Listening on port 8080!")})},function(e,n){e.exports=require("mongoose")},function(e,n){e.exports=require("body-parser")},function(e,n,o){e.exports=function(e){e.use("/login",o(11)),e.use("/portal",o(17))}},function(e,n,o){var t=o(0).Router();t.use("/auth",o(12)),e.exports=t},function(e,n,o){var t=o(0).Router();o(2).config();o(3)(),o(1);var s=o(13),r=(o(4),o(5),o(6));r.config.update({region:"ca-central-1"});var c=new r.CognitoIdentityServiceProvider;new r.CognitoIdentity;t.post("/authenticateuser",function(e,n){console.log("server");var o=e.body,t=o.value.user;console.log(o);var i={AuthFlow:"USER_PASSWORD_AUTH",ClientId:process.env.ClientId,AuthParameters:{USERNAME:o.value.user,PASSWORD:o.value.pass}};c.initiateAuth(i,function(e,c){if(e)console.log(e,e.stack),n.json(e);else if(c.ChallengeName===process.env.Challenge_NEW_PASS)n.json({changePass:"changepass",session:c.Session});else if(c.ChallengeName===process.env.Challenge_MFA)console.log(c),n.json({MFA:"MFA",session:c.Session,user:o.value.user});else{var i=c.AuthenticationResult.AccessToken,a=c.AuthenticationResult.IdToken;r.config.credentials=new r.CognitoIdentityCredentials(s.createLoginMap(process.env.IdentityPoolId,process.env.CognitoIdp,a,t,process.env.Region)),n.json({accessToken:i,idToken:a,user:o.value.user})}})}),t.post("/sendnewpass",function(e,n){var o={ChallengeName:process.env.Challenge_NEW_PASS,ClientId:process.env.ClientId,ChallengeResponses:{USERNAME:"".concat(e.body.user),NEW_PASSWORD:"".concat(e.body.newPass)},Session:e.body.session};c.respondToAuthChallenge(o,function(o,t){if(o)n.json(o);else if(t.ChallengeName===process.env.Challenge_MFA)console.log(t),n.json({MFA:"MFA",session:t.Session,user:e.body.user});else{var s=t.AuthenticationResult.AccessToken,r=t.AuthenticationResult.IdToken;n.json({accessToken:s,idToken:r,user:e.body.user})}})}),t.post("/sendmfa",function(e,n){var o=e.body,t=e.body.value.user,i={ChallengeName:process.env.Challenge_MFA,ClientId:process.env.ClientId,ChallengeResponses:{USERNAME:"".concat(e.body.value.user),SMS_MFA_CODE:"".concat(o.value.MFA)},Session:e.body.value.session};c.respondToAuthChallenge(i,function(o,c){if(o)n.json(o);else{var i=c.AuthenticationResult.AccessToken,a=c.AuthenticationResult.IdToken;r.config.credentials=new r.CognitoIdentityCredentials(s.createLoginMap(process.env.IdentityPoolId,process.env.CognitoIdp,a,t,process.env.Region)),n.json({accessToken:i,idToken:a,user:e.body.value.user})}})}),t.post("/logoutuser",function(e,n){var o=JSON.parse(e.body.value.uservalTemp);console.log(o);var t={AccessToken:"".concat(o.accessToken)};c.globalSignOut(t,function(e,o){e?n.json({putData:e,signOut:!1}):n.json({putData:o,signOut:!0})})}),e.exports=t},function(e,n,o){var t=o(14);e.exports={createLoginMap:function(e,n,o,s,r){return{IdentityPoolId:e,Logins:t({},n,o),LoginId:s,region:r}}}},function(e,n){e.exports=require("@babel/runtime/helpers/defineProperty")},function(e,n){e.exports=require("@babel/runtime/helpers/slicedToArray")},function(e,n){e.exports=require("fs")},function(e,n,o){var t=o(0).Router();t.use("/auth",o(18)),e.exports=t},function(e,n,o){var t=o(19),s=o(20),r=o(0).Router();o(2).config();var c=o(3)(),i=o(1),a=o(4),u=o(5),l=o(6);l.config.update({region:"ca-central-1"});var d=new l.CognitoIdentityServiceProvider;r.post("/coverter/csvjson",c.single("csv"),function(e,n){var o=e.file.buffer.toString("utf8");i(o,{columns:!0},function(e,o){var t=a.storeData(o);t?n.json(t):n.json("Please follow header guidelines")})}),r.post("/transfer/checks3",function(e,n,o){console.log("transfer started");var t=e.body.val;console.log(t);var s={AccessToken:"".concat(t.acToken)};d.getUser(s,function(o,s){var r,c;o?(console.log("error on check"),console.log(o),n.json("noAuth")):(console.log("get user results"),console.log(s),r=t,c=e.body.jsonReadyForS3,l.config.credentials.get(function(e){if(e)console.log("errored on creds"),console.log(e);else{var o,t,s;o=l.config.credentials.accessKeyId,t=l.config.credentials.secretAccessKey,s=l.config.credentials.sessionToken;var i={accessKeyId:"".concat(o),secretAccessKey:"".concat(t),sessionToken:"".concat(s)},a=new l.S3({creds:i,signatureVersion:"v4"}),d=r.fileName,f=d.split(".")[0],p=f.split("_"),g=d.substr(0,d.lastIndexOf("."))+".JSON",v={Bucket:process.env.Main_Bucket,Key:"RCL/Partner-List/".concat(process.env.Partner_ID)},y={Bucket:process.env.Main_Bucket,Key:"RCL/Archive/Users/".concat(r.email,"/").concat(g)},h={Bucket:process.env.Main_Bucket,Key:"RCL/Active/Users/".concat(r.email,"/").concat(g)},b={Bucket:process.env.Main_Bucket,Key:"RCL/Active/Users/".concat(r.email,"/")};a.getObject(v,function(e,o){console.log("starting getobject"),e?(console.log(e),n.json(e)):u.readFile(o.Body,c,p[0],function(e){switch(e){case"Partner exists":stepToUpload();break;case"Partner does not exist":return n.json("unauthorized-Partner"),!1}})}),stepToUpload=function(){a.headObject(b,function(e,o){e?(console.log(e),n.json("noEmail")):a.headObject(h,function(e,o){e?a.headObject(y,function(e,o){e?n.json("noFile"):n.json("fileExists")}):n.json("fileExists")})})}}}))})}),r.post("/transfer/sendtos3",function(e,n,o){var r=e.body.val;console.log("-----on upload-----"),l.config.credentials.get(function(o){if(o)console.log(o),n.json(o);else{var c=l.config.credentials.accessKeyId,i=l.config.credentials.secretAccessKey,a=l.config.credentials.sessionToken,u={accessKeyId:"".concat(c),secretAccessKey:"".concat(i),sessionToken:"".concat(a)};console.log("last creds"),console.log(u);var f=new l.S3({creds:u,signatureVersion:"v4"}),p={Bucket:process.env.Main_Bucket,Key:"RCL/Active/Users/".concat(e.body.val.email,"/").concat(e.body.jsonName),Body:JSON.stringify(e.body.jsonReadyForS3),ServerSideEncryption:process.env.Encryption};f.putObject(p,function(){var e=s(t.mark(function e(o,s){var c,i;return t.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o?(c={AccessToken:"".concat(r.acToken)},d.globalSignOut(c,function(e,n){}),n.json(o)):(i={AccessToken:"".concat(r.acToken)},d.globalSignOut(i,function(e,o){e?n.json({putData:e,signOut:!1}):n.json({putData:s,signOut:!0})}));case 1:case"end":return e.stop()}},e)}));return function(n,o){return e.apply(this,arguments)}}())}})}),e.exports=r},function(e,n){e.exports=require("@babel/runtime/regenerator")},function(e,n){e.exports=require("@babel/runtime/helpers/asyncToGenerator")}]);